
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="WeSplit - Split expenses socially, settle instantly with crypto">
      
      
        <meta name="author" content="WeSplit Team">
      
      
        <link rel="canonical" href="https://YOUR_USERNAME.github.io/WeSplit/guides/FIREBASE_EMULATOR_VS_PRODUCTION/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Firebase Functions: Emulator vs Production Differences - WeSplit Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#firebase-functions-emulator-vs-production-differences" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="WeSplit Documentation" class="md-header__button md-logo" aria-label="WeSplit Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WeSplit Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Firebase Functions: Emulator vs Production Differences
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="dark" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/YOUR_USERNAME/WeSplit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    WeSplit
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.md" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../CORBITS_X402_INTEGRATION_PLAN.md" class="md-tabs__link">
          
  
  
  Corbits Integration

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../AUTH_CONFIG_STATUS/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../BADGE_SETUP_SUMMARY/" class="md-tabs__link">
          
  
  
  Features

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../QUICK_TEST_GUIDE/" class="md-tabs__link">
          
  
  
  Testing

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="WeSplit Documentation" class="md-nav__button md-logo" aria-label="WeSplit Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    WeSplit Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/YOUR_USERNAME/WeSplit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    WeSplit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Corbits Integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Corbits Integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CORBITS_X402_INTEGRATION_PLAN.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integration Plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AUTH_CONFIG_STATUS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PHANTOM_INTEGRATION_PLAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phantom Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../BADGE_SETUP_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Badges
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../REFERRAL_SYSTEM_COMPLETE.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Referrals
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../QUICK_TEST_GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Test Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LOCAL_BUILD_SETUP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local Build
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-environment-variables-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Environment Variables &amp; Secrets
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Environment Variables &amp; Secrets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#emulator" class="md-nav__link">
    <span class="md-ellipsis">
      
        Emulator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-network-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Network Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Network Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#emulator_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Emulator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-cold-start-performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Cold Start &amp; Performance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Cold Start &amp; Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#emulator_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Emulator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-error-handling-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Error Handling &amp; Logging
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Error Handling &amp; Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#emulator_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Emulator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-timeouts-resource-limits" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Timeouts &amp; Resource Limits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Timeouts &amp; Resource Limits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#emulator_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Emulator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-firestore-database-access" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Firestore &amp; Database Access
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Firestore &amp; Database Access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#emulator_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Emulator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-authentication-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Authentication &amp; Security
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Authentication &amp; Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#emulator_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Emulator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-network-rpc-calls" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Network &amp; RPC Calls
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Network &amp; RPC Calls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#emulator_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        Emulator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-code-execution-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Code Execution Context
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Code Execution Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#emulator_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        Emulator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-common-issues-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. Common Issues &amp; Solutions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Common Issues &amp; Solutions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue-1-internal-error-in-production" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 1: "internal" Error in Production
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-2-secrets-not-found" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 2: Secrets Not Found
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-3-network-configuration-mismatch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 3: Network Configuration Mismatch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-4-timeout-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 4: Timeout Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-5-cold-start-delays" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 5: Cold Start Delays
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-6-firestore-connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 6: Firestore Connection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-development-emulator" class="md-nav__link">
    <span class="md-ellipsis">
      
        For Development (Emulator)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-production" class="md-nav__link">
    <span class="md-ellipsis">
      
        For Production
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-debugging-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        12. Debugging Checklist
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-quick-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        13. Quick Reference
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-specific-to-your-codebase" class="md-nav__link">
    <span class="md-ellipsis">
      
        14. Specific to Your Codebase
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="14. Specific to Your Codebase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transaction-signing-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transaction Signing Service
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-production-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Production Issues
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="firebase-functions-emulator-vs-production-differences">Firebase Functions: Emulator vs Production Differences<a class="headerlink" href="#firebase-functions-emulator-vs-production-differences" title="Permanent link">&para;</a></h1>
<p><strong>Date:</strong> 2025-01-14<br />
<strong>Purpose:</strong> Document key behavioral differences between Firebase Functions emulator and production deployment</p>
<hr />
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The Firebase Functions emulator and production deployment have several important differences that can cause code to work in one environment but fail in the other. Understanding these differences is crucial for debugging and ensuring consistent behavior.</p>
<hr />
<h2 id="1-environment-variables-secrets">1. Environment Variables &amp; Secrets<a class="headerlink" href="#1-environment-variables-secrets" title="Permanent link">&para;</a></h2>
<h3 id="emulator">Emulator<a class="headerlink" href="#emulator" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>Loads from <code>.env</code> files</strong> - Uses <code>dotenv</code> to load from root <code>.env</code> or <code>services/firebase-functions/.env</code></li>
<li>✅ <strong>Shell environment variables</strong> - Can use <code>export</code> commands before starting</li>
<li>✅ <strong>Manual secret loading</strong> - Secrets must be explicitly loaded via <code>.env</code> file or shell exports</li>
<li>⚠️ <strong>No automatic Firebase Secrets</strong> - Must manually provide secrets via <code>.env</code> file</li>
</ul>
<p><strong>How it works:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1">// services/firebase-functions/src/index.js</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FUNCTIONS_EMULATOR</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;true&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;production&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dotenv&#39;</span><span class="p">).</span><span class="nx">config</span><span class="p">({</span><span class="w"> </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="nx">rootEnvPath</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="c1">// Loads from .env file</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="production">Production<a class="headerlink" href="#production" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>Firebase Secrets automatically available</strong> - Secrets are automatically injected as <code>process.env</code> variables</li>
<li>✅ <strong>No <code>.env</code> file needed</strong> - Secrets are managed via Firebase Secret Manager</li>
<li>✅ <strong>Secrets are secure</strong> - Stored encrypted in Firebase Secret Manager</li>
<li>⚠️ <strong>Must set secrets via Firebase CLI</strong> - <code>firebase functions:secrets:set SECRET_NAME</code></li>
</ul>
<p><strong>How it works:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1">// In production, Firebase automatically injects secrets as process.env variables</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">companyWalletAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">COMPANY_WALLET_ADDRESS</span><span class="p">;</span><span class="w"> </span><span class="c1">// From Firebase Secrets</span>
</code></pre></div></p>
<p><strong>Key Difference:</strong> Emulator requires manual secret loading, production automatically has secrets available.</p>
<hr />
<h2 id="2-network-configuration">2. Network Configuration<a class="headerlink" href="#2-network-configuration" title="Permanent link">&para;</a></h2>
<h3 id="emulator_1">Emulator<a class="headerlink" href="#emulator_1" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>Uses <code>.env</code> file variables</strong> - <code>EXPO_PUBLIC_FORCE_MAINNET</code>, <code>EXPO_PUBLIC_DEV_NETWORK</code>, etc.</li>
<li>✅ <strong>Can override easily</strong> - Just edit <code>.env</code> file and restart emulator</li>
<li>⚠️ <strong>Must match frontend</strong> - If frontend uses <code>EXPO_PUBLIC_DEV_NETWORK=mainnet</code>, emulator must have same value</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># .env file</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nv">EXPO_PUBLIC_FORCE_MAINNET</span><span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nv">EXPO_PUBLIC_DEV_NETWORK</span><span class="o">=</span>mainnet
</code></pre></div></p>
<h3 id="production_1">Production<a class="headerlink" href="#production_1" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>Uses Firebase Secrets or environment variables</strong> - Can set via Firebase Secrets or build-time environment variables</li>
<li>⚠️ <strong>Must be set before deployment</strong> - Cannot change without redeploying</li>
<li>⚠️ <strong>Must match frontend build</strong> - EAS build sets these at build time</li>
</ul>
<p><strong>Key Difference:</strong> Emulator can change network config instantly, production requires redeployment.</p>
<hr />
<h2 id="3-cold-start-performance">3. Cold Start &amp; Performance<a class="headerlink" href="#3-cold-start-performance" title="Permanent link">&para;</a></h2>
<h3 id="emulator_2">Emulator<a class="headerlink" href="#emulator_2" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>Fast cold start</strong> - Usually &lt; 100ms (runs on your machine)</li>
<li>✅ <strong>No cold start delays</strong> - Functions start immediately</li>
<li>✅ <strong>Consistent performance</strong> - No network latency to Google Cloud</li>
<li>⚠️ <strong>Limited by your machine</strong> - Performance depends on your CPU/RAM</li>
</ul>
<h3 id="production_2">Production<a class="headerlink" href="#production_2" title="Permanent link">&para;</a></h3>
<ul>
<li>⚠️ <strong>Slower cold start</strong> - Can take 1-5 seconds (especially with secrets)</li>
<li>⚠️ <strong>Cold start delays</strong> - First invocation after inactivity is slower</li>
<li>⚠️ <strong>Network latency</strong> - Additional latency to Google Cloud infrastructure</li>
<li>✅ <strong>Better after warm-up</strong> - Subsequent invocations are fast</li>
</ul>
<p><strong>Key Difference:</strong> Production has cold start delays that can cause timeouts, emulator is always fast.</p>
<hr />
<h2 id="4-error-handling-logging">4. Error Handling &amp; Logging<a class="headerlink" href="#4-error-handling-logging" title="Permanent link">&para;</a></h2>
<h3 id="emulator_3">Emulator<a class="headerlink" href="#emulator_3" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>Detailed console logs</strong> - See all <code>console.log()</code> output in real-time</li>
<li>✅ <strong>Stack traces visible</strong> - Full error stack traces in terminal</li>
<li>✅ <strong>Immediate feedback</strong> - See errors as they happen</li>
<li>✅ <strong>Better debugging</strong> - Can use <code>debugger</code> statements</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Emulator terminal shows:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>&gt;<span class="w"> </span>Error<span class="w"> </span>processing<span class="w"> </span>USDC<span class="w"> </span>transfer:<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>&gt;<span class="w">   </span>error:<span class="w"> </span><span class="s1">&#39;Connection not initialized&#39;</span>,
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>&gt;<span class="w">   </span>errorStack:<span class="w"> </span><span class="s1">&#39;Error: Connection not initialized\n    at ...&#39;</span>,
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>&gt;<span class="w">   </span>totalTimeMs:<span class="w"> </span><span class="m">1234</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>&gt;<span class="w"> </span><span class="o">}</span>
</code></pre></div></p>
<h3 id="production_3">Production<a class="headerlink" href="#production_3" title="Permanent link">&para;</a></h3>
<ul>
<li>⚠️ <strong>Logs in Firebase Console</strong> - Must check Firebase Console for logs</li>
<li>⚠️ <strong>Delayed log visibility</strong> - Logs may take 10-30 seconds to appear</li>
<li>⚠️ <strong>Generic errors</strong> - Errors may be wrapped as "internal" without details</li>
<li>⚠️ <strong>Limited debugging</strong> - Cannot use <code>debugger</code> statements</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">// Production may show generic error:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nx">FirebaseError</span><span class="o">:</span><span class="w"> </span><span class="nx">internal</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1">// Instead of the actual error message</span>
</code></pre></div></p>
<p><strong>Key Difference:</strong> Emulator shows detailed errors immediately, production logs are delayed and may be generic.</p>
<hr />
<h2 id="5-timeouts-resource-limits">5. Timeouts &amp; Resource Limits<a class="headerlink" href="#5-timeouts-resource-limits" title="Permanent link">&para;</a></h2>
<h3 id="emulator_4">Emulator<a class="headerlink" href="#emulator_4" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>No timeout limits</strong> - Can run indefinitely (limited by your machine)</li>
<li>✅ <strong>No memory limits</strong> - Limited only by your machine's RAM</li>
<li>✅ <strong>No invocation limits</strong> - Can call functions unlimited times</li>
<li>⚠️ <strong>May be slower</strong> - Depends on your machine's performance</li>
</ul>
<h3 id="production_4">Production<a class="headerlink" href="#production_4" title="Permanent link">&para;</a></h3>
<ul>
<li>⚠️ <strong>Timeout limits</strong> - Default 60 seconds, can be configured up to 540 seconds</li>
<li>⚠️ <strong>Memory limits</strong> - Must specify memory (128MB, 256MB, 512MB, etc.)</li>
<li>⚠️ <strong>Invocation limits</strong> - Free tier has limits, paid tier has quotas</li>
<li>✅ <strong>Better performance</strong> - After warm-up, Google Cloud infrastructure is fast</li>
</ul>
<p><strong>Key Difference:</strong> Production has strict limits, emulator is more lenient.</p>
<hr />
<h2 id="6-firestore-database-access">6. Firestore &amp; Database Access<a class="headerlink" href="#6-firestore-database-access" title="Permanent link">&para;</a></h2>
<h3 id="emulator_5">Emulator<a class="headerlink" href="#emulator_5" title="Permanent link">&para;</a></h3>
<ul>
<li>⚠️ <strong>Can connect to production Firestore</strong> - By default, emulator connects to production Firestore</li>
<li>⚠️ <strong>No Firestore emulator</strong> - Unless you explicitly start Firestore emulator</li>
<li>⚠️ <strong>Production data</strong> - Changes affect production database (unless using Firestore emulator)</li>
<li>✅ <strong>Fast database access</strong> - Direct connection to Firebase</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># Emulator connects to production Firestore by default</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="c1"># To use Firestore emulator:</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>firebase<span class="w"> </span>emulators:start<span class="w"> </span>--only<span class="w"> </span>functions,firestore
</code></pre></div></p>
<h3 id="production_5">Production<a class="headerlink" href="#production_5" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>Always uses production Firestore</strong> - No choice, always production</li>
<li>✅ <strong>Optimized connections</strong> - Google Cloud optimizes database connections</li>
<li>⚠️ <strong>Network latency</strong> - Additional latency to database</li>
</ul>
<p><strong>Key Difference:</strong> Emulator can accidentally modify production data, production always uses production data.</p>
<hr />
<h2 id="7-authentication-security">7. Authentication &amp; Security<a class="headerlink" href="#7-authentication-security" title="Permanent link">&para;</a></h2>
<h3 id="emulator_6">Emulator<a class="headerlink" href="#emulator_6" title="Permanent link">&para;</a></h3>
<ul>
<li>⚠️ <strong>Can skip authentication</strong> - Emulator may not enforce authentication checks</li>
<li>⚠️ <strong>No auth emulator</strong> - Unless explicitly started</li>
<li>⚠️ <strong>Less secure</strong> - Easier to bypass security checks</li>
<li>✅ <strong>Easier testing</strong> - Can test without authentication</li>
</ul>
<h3 id="production_6">Production<a class="headerlink" href="#production_6" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>Strict authentication</strong> - All authentication checks are enforced</li>
<li>✅ <strong>Secure by default</strong> - Cannot bypass security checks</li>
<li>⚠️ <strong>Requires valid tokens</strong> - Must have valid Firebase Auth tokens</li>
</ul>
<p><strong>Key Difference:</strong> Emulator may skip auth checks, production always enforces them.</p>
<hr />
<h2 id="8-network-rpc-calls">8. Network &amp; RPC Calls<a class="headerlink" href="#8-network-rpc-calls" title="Permanent link">&para;</a></h2>
<h3 id="emulator_7">Emulator<a class="headerlink" href="#emulator_7" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>Uses your network</strong> - RPC calls go through your internet connection</li>
<li>✅ <strong>Can use localhost</strong> - Can connect to local services</li>
<li>⚠️ <strong>Your network speed</strong> - Limited by your internet connection</li>
<li>⚠️ <strong>Firewall issues</strong> - May be blocked by your firewall</li>
</ul>
<h3 id="production_7">Production<a class="headerlink" href="#production_7" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>Google Cloud network</strong> - RPC calls go through Google Cloud's network</li>
<li>✅ <strong>Better reliability</strong> - Google Cloud has better network infrastructure</li>
<li>✅ <strong>Faster RPC calls</strong> - Optimized network paths</li>
<li>⚠️ <strong>Cannot use localhost</strong> - Cannot connect to local services</li>
</ul>
<p><strong>Key Difference:</strong> Emulator uses your network, production uses Google Cloud's optimized network.</p>
<hr />
<h2 id="9-code-execution-context">9. Code Execution Context<a class="headerlink" href="#9-code-execution-context" title="Permanent link">&para;</a></h2>
<h3 id="emulator_8">Emulator<a class="headerlink" href="#emulator_8" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>Runs on your machine</strong> - Uses your Node.js version</li>
<li>✅ <strong>Can use local files</strong> - Can access local file system</li>
<li>✅ <strong>Can use local services</strong> - Can connect to localhost services</li>
<li>⚠️ <strong>Environment differences</strong> - May differ from production environment</li>
</ul>
<h3 id="production_8">Production<a class="headerlink" href="#production_8" title="Permanent link">&para;</a></h3>
<ul>
<li>✅ <strong>Runs on Google Cloud</strong> - Uses Google Cloud's Node.js runtime</li>
<li>⚠️ <strong>Read-only file system</strong> - Cannot write to file system (except <code>/tmp</code>)</li>
<li>⚠️ <strong>No localhost</strong> - Cannot connect to localhost services</li>
<li>✅ <strong>Consistent environment</strong> - Same environment for all invocations</li>
</ul>
<p><strong>Key Difference:</strong> Emulator runs on your machine, production runs on Google Cloud with restrictions.</p>
<hr />
<h2 id="10-common-issues-solutions">10. Common Issues &amp; Solutions<a class="headerlink" href="#10-common-issues-solutions" title="Permanent link">&para;</a></h2>
<h3 id="issue-1-internal-error-in-production">Issue 1: "internal" Error in Production<a class="headerlink" href="#issue-1-internal-error-in-production" title="Permanent link">&para;</a></h3>
<p><strong>Cause:</strong> Generic error wrapping in production hides actual error<br />
<strong>Symptoms:</strong>
- Works in emulator but fails in production
- Error message is just "internal" with no details
- Transaction fails with generic FirebaseError</p>
<p><strong>Root Causes:</strong>
1. <strong>Secrets not loaded</strong> - Firebase Secrets not set in production
2. <strong>Initialization failures</strong> - Service initialization fails silently
3. <strong>Network configuration mismatch</strong> - Wrong RPC endpoint
4. <strong>Timeout during initialization</strong> - Cold start takes too long
5. <strong>Error handling issues</strong> - Errors are caught but not properly logged</p>
<p><strong>Solution:</strong>
1. ✅ <strong>Enhanced error logging</strong> (already implemented) - Check Firebase Console logs for detailed errors
2. ✅ <strong>Verify Firebase Secrets</strong> - Ensure <code>COMPANY_WALLET_ADDRESS</code> and <code>COMPANY_WALLET_SECRET_KEY</code> are set
3. ✅ <strong>Check initialization logs</strong> - Look for "Failed to initialize transaction signing service" in logs
4. ✅ <strong>Verify network configuration</strong> - Ensure production has correct network environment variables
5. ✅ <strong>Check timeout settings</strong> - Ensure timeout is sufficient (currently 30 seconds)</p>
<p><strong>Debugging Steps:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># 1. Check if secrets are set</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>firebase<span class="w"> </span>functions:secrets:access<span class="w"> </span>COMPANY_WALLET_ADDRESS
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>firebase<span class="w"> </span>functions:secrets:access<span class="w"> </span>COMPANY_WALLET_SECRET_KEY
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c1"># 2. Check Firebase Console logs</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="c1"># Go to Firebase Console &gt; Functions &gt; Logs</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="c1"># Look for detailed error messages with stack traces</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="c1"># 3. Check initialization logs</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="c1"># Look for &quot;Transaction signing service initialized successfully&quot; or errors</span>
</code></pre></div></p>
<h3 id="issue-2-secrets-not-found">Issue 2: Secrets Not Found<a class="headerlink" href="#issue-2-secrets-not-found" title="Permanent link">&para;</a></h3>
<p><strong>Emulator:</strong> 
- Check <code>.env</code> file exists and has correct values
- Verify secrets are loaded: <code>echo $COMPANY_WALLET_ADDRESS</code>
- Check emulator startup logs for "✅ COMPANY_WALLET_ADDRESS loaded"</p>
<p><strong>Production:</strong> 
- Verify secrets are set: <code>firebase functions:secrets:access SECRET_NAME</code>
- Check Firebase Console &gt; Functions &gt; Configuration for bound secrets
- Ensure secrets are bound in <code>functions.runWith({ secrets: [...] })</code></p>
<p><strong>Key Difference:</strong> Emulator loads from <code>.env</code>, production loads from Firebase Secret Manager</p>
<h3 id="issue-3-network-configuration-mismatch">Issue 3: Network Configuration Mismatch<a class="headerlink" href="#issue-3-network-configuration-mismatch" title="Permanent link">&para;</a></h3>
<p><strong>Emulator:</strong> 
- Check <code>.env</code> file has <code>EXPO_PUBLIC_DEV_NETWORK=mainnet</code> or <code>EXPO_PUBLIC_FORCE_MAINNET=true</code>
- Verify network is logged: Look for "🌐 Network: mainnet" in emulator startup logs
- Check <code>transactionSigningService.js</code> logs for "Final network selection"</p>
<p><strong>Production:</strong> 
- Verify Firebase Secrets or build-time environment variables match
- Check Firebase Console logs for "Final network selection: { network: 'mainnet' }"
- Ensure EAS build has correct environment variables in <code>eas.json</code></p>
<p><strong>Key Difference:</strong> Emulator uses <code>.env</code> file, production uses Firebase Secrets or build-time env vars</p>
<h3 id="issue-4-timeout-errors">Issue 4: Timeout Errors<a class="headerlink" href="#issue-4-timeout-errors" title="Permanent link">&para;</a></h3>
<p><strong>Emulator:</strong> 
- Usually not an issue (no timeout limits)
- Can run indefinitely
- Limited only by your machine's resources</p>
<p><strong>Production:</strong> 
- Default timeout is 60 seconds
- Current setting: <code>timeoutSeconds: 30</code> (may be too short for cold starts)
- Increase timeout: <code>functions.runWith({ timeoutSeconds: 60 })</code>
- Consider: Cold start + initialization can take 2-5 seconds</p>
<p><strong>Key Difference:</strong> Emulator has no timeouts, production has strict timeout limits</p>
<h3 id="issue-5-cold-start-delays">Issue 5: Cold Start Delays<a class="headerlink" href="#issue-5-cold-start-delays" title="Permanent link">&para;</a></h3>
<p><strong>Emulator:</strong> No cold starts<br />
<strong>Production:</strong> First invocation after inactivity is slower - consider keeping functions warm</p>
<h3 id="issue-6-firestore-connection">Issue 6: Firestore Connection<a class="headerlink" href="#issue-6-firestore-connection" title="Permanent link">&para;</a></h3>
<p><strong>Emulator:</strong> May connect to production Firestore (check emulator logs)<br />
<strong>Production:</strong> Always uses production Firestore</p>
<hr />
<h2 id="11-best-practices">11. Best Practices<a class="headerlink" href="#11-best-practices" title="Permanent link">&para;</a></h2>
<h3 id="for-development-emulator">For Development (Emulator)<a class="headerlink" href="#for-development-emulator" title="Permanent link">&para;</a></h3>
<ol>
<li>✅ <strong>Use <code>.env</code> file</strong> - Centralize all environment variables</li>
<li>✅ <strong>Test with production-like data</strong> - Use production Firestore for realistic testing</li>
<li>✅ <strong>Monitor logs</strong> - Watch emulator terminal for errors</li>
<li>✅ <strong>Test timeout scenarios</strong> - Add delays to simulate production cold starts</li>
</ol>
<h3 id="for-production">For Production<a class="headerlink" href="#for-production" title="Permanent link">&para;</a></h3>
<ol>
<li>✅ <strong>Set Firebase Secrets</strong> - Use <code>firebase functions:secrets:set</code></li>
<li>✅ <strong>Test before deploying</strong> - Always test in emulator first</li>
<li>✅ <strong>Monitor Firebase Console</strong> - Check logs for errors</li>
<li>✅ <strong>Set appropriate timeouts</strong> - Configure timeout based on function needs</li>
<li>✅ <strong>Use structured logging</strong> - Log detailed error information (already implemented)</li>
</ol>
<hr />
<h2 id="12-debugging-checklist">12. Debugging Checklist<a class="headerlink" href="#12-debugging-checklist" title="Permanent link">&para;</a></h2>
<p>When code works in emulator but fails in production:</p>
<ul>
<li>[ ] <strong>Check Firebase Secrets</strong> - Are secrets set in Firebase Secret Manager?</li>
<li>[ ] <strong>Check network configuration</strong> - Do environment variables match between emulator and production?</li>
<li>[ ] <strong>Check Firebase Console logs</strong> - Look for detailed error messages</li>
<li>[ ] <strong>Check timeout settings</strong> - Is function timing out in production?</li>
<li>[ ] <strong>Check cold start</strong> - Is first invocation slower than expected?</li>
<li>[ ] <strong>Check error handling</strong> - Are errors being properly logged?</li>
<li>[ ] <strong>Check Firestore access</strong> - Are database operations working correctly?</li>
<li>[ ] <strong>Check authentication</strong> - Are auth tokens valid in production?</li>
</ul>
<hr />
<h2 id="13-quick-reference">13. Quick Reference<a class="headerlink" href="#13-quick-reference" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Emulator</th>
<th>Production</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Secrets</strong></td>
<td><code>.env</code> file</td>
<td>Firebase Secrets</td>
</tr>
<tr>
<td><strong>Cold Start</strong></td>
<td>&lt; 100ms</td>
<td>1-5 seconds</td>
</tr>
<tr>
<td><strong>Timeouts</strong></td>
<td>None</td>
<td>60s default (configurable)</td>
</tr>
<tr>
<td><strong>Logs</strong></td>
<td>Terminal (immediate)</td>
<td>Firebase Console (delayed)</td>
</tr>
<tr>
<td><strong>Firestore</strong></td>
<td>Production (default)</td>
<td>Production (always)</td>
</tr>
<tr>
<td><strong>Network</strong></td>
<td>Your connection</td>
<td>Google Cloud</td>
</tr>
<tr>
<td><strong>Error Details</strong></td>
<td>Full stack traces</td>
<td>May be generic</td>
</tr>
<tr>
<td><strong>Debugging</strong></td>
<td>Easy (debugger works)</td>
<td>Harder (logs only)</td>
</tr>
<tr>
<td><strong>Initialization</strong></td>
<td>Fast (&lt; 100ms)</td>
<td>Slower (200-500ms on cold start)</td>
</tr>
<tr>
<td><strong>Error Messages</strong></td>
<td>Detailed</td>
<td>May be wrapped as "internal"</td>
</tr>
</tbody>
</table>
<h2 id="14-specific-to-your-codebase">14. Specific to Your Codebase<a class="headerlink" href="#14-specific-to-your-codebase" title="Permanent link">&para;</a></h2>
<h3 id="transaction-signing-service">Transaction Signing Service<a class="headerlink" href="#transaction-signing-service" title="Permanent link">&para;</a></h3>
<p><strong>Emulator:</strong>
- Initialization: &lt; 100ms (no cold start)
- Secrets: Loaded from <code>.env</code> file
- Network: Determined from <code>.env</code> variables
- Errors: Full stack traces in terminal</p>
<p><strong>Production:</strong>
- Initialization: 200-500ms on cold start (can cause blockhash expiration)
- Secrets: Loaded from Firebase Secrets (automatic)
- Network: Determined from Firebase Secrets or build-time env vars
- Errors: May be wrapped as "internal" - check Firebase Console logs</p>
<h3 id="common-production-issues">Common Production Issues<a class="headerlink" href="#common-production-issues" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>"internal" Error</strong></li>
<li><strong>Check:</strong> Firebase Console logs for detailed error</li>
<li><strong>Look for:</strong> "Failed to initialize transaction signing service"</li>
<li>
<p><strong>Verify:</strong> Secrets are set: <code>firebase functions:secrets:access COMPANY_WALLET_ADDRESS</code></p>
</li>
<li>
<p><strong>Network Mismatch</strong></p>
</li>
<li><strong>Check:</strong> Firebase Console logs for "Final network selection"</li>
<li><strong>Verify:</strong> Production has <code>EXPO_PUBLIC_DEV_NETWORK=mainnet</code> or <code>EXPO_PUBLIC_FORCE_MAINNET=true</code></li>
<li>
<p><strong>Solution:</strong> Set as Firebase Secret or in EAS build environment</p>
</li>
<li>
<p><strong>Initialization Timeout</strong></p>
</li>
<li><strong>Check:</strong> Firebase Console logs for "Service initialization took longer than expected"</li>
<li><strong>Solution:</strong> Increase timeout or optimize initialization</li>
<li>
<p><strong>Current:</strong> <code>timeoutSeconds: 30</code> (may need to increase to 60)</p>
</li>
<li>
<p><strong>Blockhash Expiration</strong></p>
</li>
<li><strong>Emulator:</strong> Less likely (faster initialization)</li>
<li><strong>Production:</strong> More likely (slower cold start + initialization)</li>
<li><strong>Solution:</strong> Already optimized - client sends fresh blockhash, backend processes quickly</li>
</ol>
<hr />
<p><strong>Last Updated:</strong> 2025-01-14</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="January 14, 2026 11:39:08 UTC">January 14, 2026</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>