# Automatic Setup Clarification

## For: External Payment Integration (e.g., "spend" Company)

**Question**: Does the integration automatically create a WeSplit account, wallet, and split without manual intervention?

---

## ✅ What IS Automatic (No User Action Required)

### 1. User Account Creation ✅
- **Status**: Fully automatic
- **When**: Immediately when payment data is received
- **What happens**:
  - User account created in Firestore `users` collection
  - Email used as identifier
  - User can be found by email immediately
- **User action required**: ❌ None

### 2. Split Creation ✅
- **Status**: Fully automatic
- **When**: Immediately when payment data is received
- **What happens**:
  - Split document created in Firestore `splits` collection
  - All invoice data stored (items, merchant, amounts)
  - User set as creator and participant
  - Split status: `'pending'`
- **User action required**: ❌ None

### 3. External Wallet Linking ✅ (If Provided)
- **Status**: Fully automatic (if `walletAddress` is provided)
- **When**: Immediately when payment data is received
- **What happens**:
  - External wallet (e.g., user's USDC wallet from "spend") is linked to user account
  - Stored in `wallet_address` field
  - Added to `linkedWallets` collection
- **User action required**: ❌ None

---

## ⚠️ What Requires User to Open App Once

### WeSplit Wallet Creation ⚠️
- **Status**: Automatic, but requires user to open app once
- **When**: First time user opens WeSplit app
- **What happens**:
  - App detects user has no WeSplit wallet
  - Automatically generates wallet with secure key storage
  - Stores wallet securely on device (SecureStore)
  - Updates user document with wallet address
- **User action required**: ✅ Open app once (wallet creation is automatic after that)

**Why this limitation?**
- WeSplit wallets require secure device storage (SecureStore)
- Private keys must be stored on device, not server
- Cannot be created server-side for security reasons
- This is a one-time setup that happens automatically when app opens

---

## Complete Flow

### When "spend" Sends Payment Data:

```
1. Payment data received from "spend"
   ↓
2. ✅ User account created/retrieved (AUTOMATIC)
   ↓
3. ✅ External wallet linked (if provided) (AUTOMATIC)
   ↓
4. ✅ Split created with all data (AUTOMATIC)
   ↓
5. Split appears in Firestore
   ↓
6. User opens WeSplit app (first time)
   ↓
7. ⚠️ WeSplit wallet created automatically (one-time)
   ↓
8. User sees split in their list
   ↓
9. User can invite others, create split wallet, collect payments
```

---

## What Users Can Do Before Opening App

**Before user opens app:**
- ✅ Account exists in database
- ✅ Split exists in database
- ✅ External wallet linked (if provided)
- ❌ WeSplit wallet not yet created (requires app open)

**After user opens app once:**
- ✅ WeSplit wallet automatically created
- ✅ User can see split in app
- ✅ User can invite others
- ✅ User can create split wallet
- ✅ User can collect payments

---

## Important Distinction: External Wallet vs WeSplit Wallet

### External Wallet (from "spend")
- **What**: User's USDC wallet address from "spend" platform
- **When created**: Already exists (user has it)
- **Stored in**: `wallet_address` field in user document
- **Purpose**: Links user's existing wallet to WeSplit account
- **Automatic**: ✅ Yes, if provided in payment data

### WeSplit Wallet
- **What**: Wallet generated by WeSplit app for the user
- **When created**: First time user opens WeSplit app
- **Stored in**: Device SecureStore + Firestore (address only)
- **Purpose**: User's primary wallet in WeSplit app
- **Automatic**: ⚠️ Yes, but requires app to be opened once

---

## For "spend" Integration

### What "spend" Needs to Know:

1. **Account Creation**: ✅ Fully automatic
   - User account is created immediately
   - No user action needed

2. **Split Creation**: ✅ Fully automatic
   - Split is created immediately with all data
   - No user action needed

3. **Wallet Creation**: ⚠️ Automatic but requires app open
   - WeSplit wallet created when user opens app first time
   - This is a one-time setup
   - Split works without it (wallet needed for payment collection)

### Recommendation for "spend":

**Option 1: Provide External Wallet (Recommended)**
- Send user's USDC wallet address in `walletAddress` field
- This wallet is linked immediately
- User can use this wallet for payments
- WeSplit wallet still created when app opens (for app features)

**Option 2: Don't Provide Wallet**
- User account and split still created automatically
- WeSplit wallet created when user opens app
- User can still use split features

---

## Summary

| Component | Automatic? | User Action Required? | Notes |
|-----------|-----------|----------------------|-------|
| User Account | ✅ Yes | ❌ No | Created immediately |
| Split | ✅ Yes | ❌ No | Created immediately |
| External Wallet Link | ✅ Yes | ❌ No | If `walletAddress` provided |
| WeSplit Wallet | ⚠️ Yes* | ✅ Open app once | *Automatic when app opens |

**Overall**: 95% automatic. Only WeSplit wallet requires user to open app once (automatic after that).

---

## User Experience

### Scenario 1: User Has "spend" Wallet
1. "spend" sends payment data with `walletAddress`
2. ✅ Account created
3. ✅ External wallet linked
4. ✅ Split created
5. User opens WeSplit app
6. ⚠️ WeSplit wallet created (automatic)
7. User sees split immediately

### Scenario 2: User Doesn't Have Wallet
1. "spend" sends payment data without `walletAddress`
2. ✅ Account created
3. ✅ Split created
4. User opens WeSplit app
5. ⚠️ WeSplit wallet created (automatic)
6. User sees split immediately

**In both cases**: Split is created and visible immediately when user opens app. Wallet creation is automatic and happens in background.

---

## Conclusion

**Yes, the setup is fully automatic for:**
- ✅ Account creation
- ✅ Split creation
- ✅ External wallet linking (if provided)

**WeSplit wallet creation is automatic but requires:**
- ⚠️ User to open app once (one-time setup)
- This happens automatically when app opens
- No manual wallet creation steps needed

**The split works immediately** - wallet is only needed for payment collection features, which user can set up after seeing the split.

---

**Last Updated**: 2024

